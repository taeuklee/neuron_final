<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="projectMapper">
  
    <resultMap type="Project" id="ProjectResultMap">
	   <id property="projectNo" column="PROJECT_NO"/>
	   <result property="projectTitle" column="PROJECT_TITLE"/>
	   <result property="projectContents" column="PROJECT_CONTENTS"/>
	   <result property="projectMaster" column="PROJECT_MASTER"/>
	   <result property="projectInsertRequest" column="PROJECT_INSERT_REQUEST"/>
	   <result property="projectDeleteRequest" column="PROJECT_DELETE_REQUEST"/>
  	</resultMap>
  	
  	
  	<resultMap type="EmpProject" id="EmpProjectResultMap">
  		<id property="empNo" column="EMP_NO"/>
  		<id property="projectNo" column="PROJECT_NO"/>
  		<result property="empAuth" column="EMP_PROJECT_AUTH"/>
  		<result property="projectTitle" column="PROJECT_TITLE"/>
  	</resultMap>
  	
  	
  	 	<resultMap type="Employee2" id="employeeResultMap">
 		<id property="empNo" column="EMP_NO"/>
 		<result property="deptNo" column="DEPT_CODE"></result>
 		<result property="teamNo" column="TEAM_CODE"></result>
 		<result property="empId" column="EMP_ID"></result>
 		<result property="empPwd" column="EMP_PWD"></result>
 		<result property="empName" column="EMP_NAME"></result>
 		<result property="empBirth" column="EMP_BIRTH"></result>
 		<result property="empPhone" column="EMP_PHONE"></result>
 		<result property="empJob" column="EMP_JOB"></result>
 		<result property="empEmail" column="EMP_EMAIL"></result>
 		<result property="empSubEmail" column="EMP_SUBEMAIL"></result>
 		<result property="empExnum" column="EMP_EXNUM"></result>
 		<result property="empState" column="EMP_STATE"></result>
 		<result property="empVac" column="EMP_VAC"></result>
 		<result property="empMed" column="EMP_MED"></result>
 		<result property="empExVac" column="EMP_EXVAC"></result>
 		<result property="empSign" column="EMP_SIGN"></result>
 		<result property="deptName" column="DEPT_NAME"></result>
<!--  		<result property="empFilname" column="EMP_FILENAME"></result> -->
<!--  		<result property="empFileRename" column="EMP_FILERENAME"></result> -->
 	</resultMap>
 	
 	<resultMap type="Team" id="teamResultMap">
 		<id property="teamNo" column="TEAM_NO"/>
 		<result property="deptNo" column="DEPT_CODE"/>
 		<result property="teamName" column="TEAM_NAME"/>
 	</resultMap>
 	
 	
 	<resultMap type="Dept" id="deptResultMap">
 		<id property="deptNo" column="DEPT_CODE"/>
 		<result property="deptName" column="DEPT_NAME"/>
 	</resultMap>
	
	<select id="insertProjectSearchList" resultMap="employeeResultMap" parameterType="hashMap">
		SELECT EMP.EMP_NAME, EMP.EMP_JOB, EMP.EMP_NO, EMP.DEPT_CODE, DEPT.DEPT_NAME  FROM EMPLOYEE EMP JOIN DEPT DEPT ON (EMP.DEPT_CODE=DEPT.DEPT_CODE) WHERE EMP.EMP_NAME LIKE '%' || #{searchText} || '%' AND NOT EMP.EMP_NO = #{empNo}
	</select>
	
	<select id="selectProjectOne" resultMap="ProjectResultMap" parameterType="Project">
		SELECT * FROM PROJECT WHERE PROJECT_TITLE = #{projectTitle} AND PROJECT_CONTENTS = #{projectContents} AND PROJECT_MASTER = #{projectMaster}
	</select>
	
	<select id="selectProjectList" resultMap="ProjectResultMap" parameterType="hashMap">
		SELECT * FROM PROJECT WHERE PROJECT_MASTER = #{empNo} AND PROJECT_INSERT_REQUEST = #{info}
	</select>
	
	<select id="selectMemberProjectList" resultMap="EmpProjectResultMap" parameterType="hashMap">
		SELECT EPRO.PROJECT_NO, EPRO.EMP_NO, EPRO.EMP_PROJECT_AUTH, PRO.PROJECT_TITLE FROM EMP_PROJECT EPRO JOIN PROJECT PRO ON (EPRO.PROJECT_NO = PRO.PROJECT_NO) WHERE EPRO.EMP_NO = #{empNo} AND PRO.PROJECT_INSERT_REQUEST = #{info}
	</select>
	
	<update id="insertProjectMemberList" parameterType="hashMap">
		<foreach collection="empNoList" item="empNoList" index="index" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL">
		INTO EMP_PROJECT(EMP_NO, PROJECT_NO, EMP_PROJECT_AUTH) VALUES(#{empNoList}, #{projectNo}, DEFAULT)
		</foreach>
	</update>
	
	<insert id="insertProjectRegister" parameterType="Project">
		INSERT INTO PROJECT VALUES(SEQ_PRO_NO.NEXTVAL, #{projectTitle}, #{projectContents}, #{projectMaster}, DEFAULT, DEFAULT)
	</insert>
  </mapper>